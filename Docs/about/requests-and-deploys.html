
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Requests and Deploys Â· Singularity</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="ui.html" />
    
    
    <link rel="prev" href="how-it-works.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    About Singularity
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="how-it-works.html">
            
                <a href="how-it-works.html">
            
                    
                    How It Works
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="requests-and-deploys.html">
            
                <a href="requests-and-deploys.html">
            
                    
                    Requests and Deploys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="ui.html">
            
                <a href="ui.html">
            
                    
                    Singularity UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="adopters.html">
            
                <a href="adopters.html">
            
                    
                    Adopters
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Getting Started
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../getting-started/try-it-out.html">
            
                <a href="../getting-started/try-it-out.html">
            
                    
                    Try It Out
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../getting-started/install.html">
            
                <a href="../getting-started/install.html">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../getting-started/basic-examples.html">
            
                <a href="../getting-started/basic-examples.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Developing
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../development/developing-with-docker.html">
            
                <a href="../development/developing-with-docker.html">
            
                    
                    Developing Using Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../development/ui.html">
            
                <a href="../development/ui.html">
            
                    
                    UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../development/load-balancer-integration.html">
            
                <a href="../development/load-balancer-integration.html">
            
                    
                    Load Balancer Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../development/basepom.html">
            
                <a href="../development/basepom.html">
            
                    
                    Basepom
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../releases/">
            
                <a href="../releases/">
            
                    
                    Releases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Feature Docs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../features/custom-ports.html">
            
                <a href="../features/custom-ports.html">
            
                    
                    Choosing Custom Ports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../features/expiring-actions.html">
            
                <a href="../features/expiring-actions.html">
            
                    
                    Expiring Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../features/shell-commands.html">
            
                <a href="../features/shell-commands.html">
            
                    
                    Shell Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../features/task-search.html">
            
                <a href="../features/task-search.html">
            
                    
                    Task Search
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../features/incremental-deploys.html">
            
                <a href="../features/incremental-deploys.html">
            
                    
                    Incremental Deploys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../features/disaster-detection.html">
            
                <a href="../features/disaster-detection.html">
            
                    
                    Disaster Detection & Disabled Actions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Reference
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../reference/configuration.html">
            
                <a href="../reference/configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../reference/container-options.html">
            
                <a href="../reference/container-options.html">
            
                    
                    Container Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../reference/database.html">
            
                <a href="../reference/database.html">
            
                    
                    Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../reference/webhooks.html">
            
                <a href="../reference/webhooks.html">
            
                    
                    Webhooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../reference/slave-extras.html">
            
                <a href="../reference/slave-extras.html">
            
                    
                    Slave Extras
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../reference/deploy-defaults.html">
            
                <a href="../reference/deploy-defaults.html">
            
                    
                    Deploy Defaults
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../reference/healthchecks.html">
            
                <a href="../reference/healthchecks.html">
            
                    
                    Health Checks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../reference/apidocs/api-index.html">
            
                <a href="../reference/apidocs/api-index.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.8.1" data-path="../reference/apidocs/api-sandbox.html">
            
                <a href="../reference/apidocs/api-sandbox.html">
            
                    
                    /api/sandbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.2" data-path="../reference/apidocs/api-slaves.html">
            
                <a href="../reference/apidocs/api-slaves.html">
            
                    
                    /api/slaves
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.3" data-path="../reference/apidocs/api-history.html">
            
                <a href="../reference/apidocs/api-history.html">
            
                    
                    /api/history
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.4" data-path="../reference/apidocs/api-state.html">
            
                <a href="../reference/apidocs/api-state.html">
            
                    
                    /api/state
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.5" data-path="../reference/apidocs/api-logs.html">
            
                <a href="../reference/apidocs/api-logs.html">
            
                    
                    /api/logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.6" data-path="../reference/apidocs/api-tasks.html">
            
                <a href="../reference/apidocs/api-tasks.html">
            
                    
                    /api/tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.7" data-path="../reference/apidocs/api-test.html">
            
                <a href="../reference/apidocs/api-test.html">
            
                    
                    /api/test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.8" data-path="../reference/apidocs/api-webhooks.html">
            
                <a href="../reference/apidocs/api-webhooks.html">
            
                    
                    /api/webhooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.9" data-path="../reference/apidocs/api-racks.html">
            
                <a href="../reference/apidocs/api-racks.html">
            
                    
                    /api/racks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.10" data-path="../reference/apidocs/api-requests.html">
            
                <a href="../reference/apidocs/api-requests.html">
            
                    
                    /api/requests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.11" data-path="../reference/apidocs/api-groups.html">
            
                <a href="../reference/apidocs/api-groups.html">
            
                    
                    /api/groups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.12" data-path="../reference/apidocs/api-deploys.html">
            
                <a href="../reference/apidocs/api-deploys.html">
            
                    
                    /api/deploys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.13" data-path="../reference/apidocs/api-disasters.html">
            
                <a href="../reference/apidocs/api-disasters.html">
            
                    
                    /api/disasters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.14" data-path="../reference/apidocs/api-priority.html">
            
                <a href="../reference/apidocs/api-priority.html">
            
                    
                    /api/priority
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.15" data-path="../reference/apidocs/models.html">
            
                <a href="../reference/apidocs/models.html">
            
                    
                    Models
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Requests and Deploys</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="requests-and-deploys">Requests and Deploys</h1>
<p>Singularity uses the concepts of a <code>Request</code> and <code>Deploy</code> to keep track of changes to a particular task or set of related tasks.</p>
<p>A <code>Request</code> can be thought of as the high level information for a single project or deployable item. For example, the name and owner&apos;s email for a single web service, or the name and cron schedule for a single scheduled job.</p>
<p>A <code>Deploy</code> can then be thought of as the specific configuration or version of the running code for that deployable item.</p>
<p>To illustrate the differences between and usages of these two concepts, we will walk through an example using Singularity to run a single web service.</p>
<h2 id="the-testservice-example">The <code>TestService</code> Example</h2>
<h3 id="creating-a-request">Creating a <code>Request</code></h3>
<p>You have a new web service called <code>TestService</code> that you want to run via Singularity. The first thing you need to do is create a <code>Request</code> for <code>TestService</code>. To create this request, you would <code>POST</code> json over http to the Singularity API (<a href="../reference/apidocs/api-requests.html#post-apirequests"><code>/api/requests</code></a>) or create a request via the new request page in the Singularity UI. Example json:</p>
<pre><code class="lang-json">{
    &quot;id&quot;: &quot;TestService&quot;,
    &quot;requestType&quot;: &quot;SERVICE&quot;,
    &quot;owners&quot;: [&quot;me@test.com&quot;],
    &quot;instances&quot;: 1,
}
</code></pre>
<p>This <code>Request</code> now holds high level information about your web service. Singularity knows it is a long running <code>SERVICE</code> named <code>TestService</code> and that you want to run <code>1</code> instance of this service.</p>
<h3 id="creating-a-deploy">Creating a <code>Deploy</code></h3>
<p>Now you want <code>TestService</code> to actually run. To do this, you need to create a <code>Deploy</code> for the <code>TestService</code> <code>Request</code>. This deploy will let Singularity know all of the information necessary to actually build and launch a task. This information includes things like the command to run, environment variables to set, the location of any artifacts to download, or the resources that should be allocated to a task. You would create this deploy by <code>POST</code>ing json to the Singularity API&apos;s deploy endpoint (<a href="../reference/apidocs/api-deploys.html#post-apideploys"><code>/api/deploys</code></a>), or creating a new deploy in the Singularity UI. Example json:</p>
<pre><code class="lang-json">{
  &quot;deploy&quot;: {
    &quot;requestId&quot;:&quot;TestService&quot;,
    &quot;id&quot;:&quot;5&quot;,
    &quot;resources&quot;: {
        &quot;cpus&quot;:1,
        &quot;memoryMb&quot;:128,
        &quot;numPorts&quot;:2
    }, 
    &quot;command&quot;:&quot;java -Ddw.server.applicationConnectors[0].port=$PORT0 -Ddw.server.adminConnectors[0].port=$PORT1 -jar singularitytest-1.0-SNAPSHOT.jar server example.yml&quot;,
    &quot;uris&quot;: [
        &quot;https://github.com/HubSpot/singularity-test-service/releases/download/1.0/singularitytest-1.0-SNAPSHOT.jar&quot;,
        &quot;https://github.com/HubSpot/singularity-test-service/releases/download/1.0/example.yml&quot;
    ],
    &quot;healthcheck&quot;: {
       &quot;uri&quot;: &quot;/&quot;
     }
  }
}
</code></pre>
<p>Posting this to Singularity creates a <code>PendingDeploy</code>. Singularity will then try to build and launch tasks using the information provided in the <code>Deploy</code> json (i.e. a task with those artifacts that needs 1 cpu, 128MB of memory, etc and is run with that command). Singularity will also know to only build and launch <code>1</code> of these tasks based on the number of instances you set in the <code>Request</code> earlier. Once that task is launched and Singularity determines it is healthy, the <code>Deploy</code> succeeds and the <code>Deploy</code> json you provided is now the <code>ActiveDeploy</code>.</p>
<h3 id="a-new-deploy">A New <code>Deploy</code></h3>
<p>Let&apos;s say some changes were made to the <code>TestService</code> code and you want to run the new version in Singularity, maybe with a bit more memory as well. You would create a new <code>Deploy</code> json with information about the new code to run, and updated memory value and <code>POST</code> that to the Singularity API (<a href="../reference/apidocs/api-deploys.html#post-apideploys"><code>/api/deploys</code></a>), or create a new deploy in the Singularity UI.</p>
<p>Singularity sees a new <code>Deploy</code> has been started and makes that the <code>PendingDeploy</code> for the <code>TestService</code> <code>Request</code>. Singularity will then try to build and launch <code>1</code> new task with the configuration specified in the new <code>PendingDeploy</code> (note that the task from the previous <code>Deploy</code> is still running and it&apos;s settings are unchanged). Once the task is launched and determined to be healthy, that new <code>Deploy</code> now becomes the <code>ActiveDeploy</code> and the task from the old deploy is shut down.</p>
<h3 id="updating-the-request">Updating the Request</h3>
<p>Now, for example, you notice <code>TestService</code> is getting more traffic than expected and you want to run <code>3</code> instances instead of just <code>1</code>. You can <code>PUT</code> a new number of instances over http to the Singularity API (<a href="../reference/apidocs/api-requests.html#put-apirequestsrequestrequestidscale"><code>/api/requests/request/{requestId}/scale</code></a>), or click <code>Scale</code> on the Singularity UI request page and enter a new number of instances to update our number of instances. Example json:</p>
<pre><code class="lang-json">{
    &quot;id&quot;: &quot;TestService&quot;,
    &quot;requestType&quot;: &quot;SERVICE&quot;,
    &quot;owners&quot;: [&quot;me@test.com&quot;],
    &quot;instances&quot;: 3,
}
</code></pre>
<p>Singularity sees this update to the request and will try to build and launch <code>2</code> additional tasks so that there are <code>3</code> total instances running. The configuration/resources/command/etc for these new tasks will be determined from the current <code>ActiveDeploy</code>. In other words, there is no need to re-deploy <code>TestService</code> to scale the number of instances up or down. This information is saved separate from the more detailed information in the deploy. If you were to create another new deploy after scaling, Singularity would then build and launch <code>3</code> new tasks for that new deploy.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="how-it-works.html" class="navigation navigation-prev " aria-label="Previous page: How It Works">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="ui.html" class="navigation navigation-next " aria-label="Next page: Singularity UI">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Requests and Deploys","level":"1.2.2","depth":2,"next":{"title":"Singularity UI","level":"1.2.3","depth":2,"path":"Docs/about/ui.md","ref":"Docs/about/ui.md","articles":[]},"previous":{"title":"How It Works","level":"1.2.1","depth":2,"path":"Docs/about/how-it-works.md","ref":"Docs/about/how-it-works.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","-sharing","-livereload","-highlight","copy-code-button"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"github":{"url":"https://github.com/HubSpot/Singularity"},"copy-code-button":{},"search":{},"lunr":{"ignoreSpecialCharacters":false,"maxIndexSize":1000000},"fontsettings":{"family":"sans","size":2,"theme":"white"},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"intro.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"releases":["0.14.1","0.14.0","0.13.0","0.12.0","0.11.0","0.10.1","0.10.0","0.9.0","0.8.0","0.7.1","0.7.0","0.6.2","0.6.1","0.6.0","0.5.0","0.4.11","0.4.10","0.4.9","0.4.8","0.4.7","0.4.6","0.4.5"]},"title":"Singularity","links":{"home":null,"about":false,"issues":"https://github.com/HubSpot/Singularity/issues","contribute":"https://github.com/HubSpot/Singularity"},"gitbook":"*"},"file":{"path":"Docs/about/requests-and-deploys.md","mtime":"2017-03-17T15:04:39.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-03-17T20:58:43.584Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

